services:
  connectors: # container for the API connectors
    image: "continuumio/miniconda3"
    container_name: sk-connectors
    working_dir: /workspace
    env_file:
      - .env
    volumes:
      - ./connectors:/workspace
    command: sleep infinity
    depends_on:
      - api
    networks:
      - sk-net

  compute: # for computations on data
    image: "continuumio/miniconda3"
    container_name: sk-compute
    working_dir: /workspace
    env_file:
      - .env
    depends_on:
      - api
    volumes:
      - ./compute:/workspace
    command: sleep infinity
    networks:
      - sk-net

  api: # REST API
    image: "python:3.11-slim-bullseye"
    container_name: sk-api
    working_dir: /usr/src
    ports:
      - "${API_PORT:-1337}:${API_PORT:-1337}"
    env_file:
      - .env
    command: sleep infinity
    restart: on-failure
    depends_on:
      - db
    volumes:
      - ./backend/:/usr/src
    networks:
      - sk-net

  web:
    image: "node:lts-alpine"
    container_name: sk-web
    working_dir: /home/node/
    user: "node"
    ports:
      - ${VITE_PORT:-3000}:${VITE_PORT:-3000}
    env_file:
      - .env
    depends_on:
      - api
    command: sleep infinity
    volumes:
      - ./frontend/:/home/node
      - ./frontend/dist:/home/node/dist/:rw
    networks:
      - sk-net

  db: # local storage
    container_name: sk-db
    image: postgres:alpine
    restart: unless-stopped
    env_file:
      - .env
    volumes:
      - sk-db-data:/var/lib/postgresql/data
    ports:
      - "${POSTGRES_PORT:-5432}:${POSTGRES_PORT:-5432}"
    networks:
      - sk-net

volumes:
  sk-db-data:
    driver: local

networks:
  sk-net:
    name: sk-network
    driver: bridge
